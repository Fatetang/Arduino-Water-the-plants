## 一款迷你型的植物浇水系统，包括代码、电路板原理图PCB图和适用3D打印的外壳
![](https://github.com/jie326513988/Arduino-Water-the-plants/blob/master/picture/js4056-1.jpg)
![](https://github.com/jie326513988/Arduino-Water-the-plants/blob/master/picture/js4056-2.jpg)
#### 注意！所以版本PCB未加到电池低压保护，电池过放会导致电池寿命下降，请使用带保护板的电池，或不要让电池电压低于3.0V。
#### 2020-03-04 PCB7.0，是最小的一块板子，直接在板上集成atmega328，电机驱动芯片换成A4950。<br>2020-03-03 PCB6.0，由两块板子拼插而成的，为了方便新手和缩小体积。

## 特点
* 根据土壤的湿度进行浇水，而不是简单定时浇水，避免不必要的浇水，更加科学的管理植物。
* 可自动休眠，节省电量，并内置750mah电池（5.0），满足数周充一次电（小型花盆），配合太阳能充电器可实现长期无人监管。
* 丰富的设置选项，应对不同的植物。
* 土壤较松的话不适合垂直放置湿度传感器，建议水平放置在花盆底部
* 3种不同的PCB结构，5.0带16340电池座，6.0和7.0仅引出电池接口
* V5.1带电池座、制作简单。V6.0拼插式体积小、制作简单。V7.1高度集成、体积最小、制作难度中等。
* 观看视频 https://space.bilibili.com/16758526/favlist?fid=769297826&ftype=create
* 3D打印件下载 https://www.thingiverse.com/thing:4025691
## 烧录说明
<br>1.使用ArduinoIDE编译上传，需要下载两次程序才可以使用在setup()找到这段程序看说明下载程序。EEPROM.put第一次写入去掉注释，第二次以后注释上，EEPROM.get第一次写入注释上，第二次以后写入去掉注释
<br>2.必须将arduino pro mini的电源指示LED和LED旁边的限流电阻焊下来，否则电量会很快耗尽，若只焊下LED没焊下电阻就读取电压会烧坏板子！

## 原理<br>
1.基本原理：浇水，休眠，唤醒，判断土壤湿度是否达到设置的值，没达到继续休眠，达到就开始浇水，浇到设定的值就休眠，不断循环。比市面上的定时浇水多了一个土壤湿度检测功能，不再是盲目的浇水。<br><br>
2.休眠时电流低至0.8ma，水泵接口输出电压5v电流800ma，可根据需求选用水泵。<br><br>
3.上电前插上电容式土壤湿度传感器，当然没插也可以开机但会报错。<br>
每次上电需要手动开启浇水功能（主界面第三项），开启浇水功能不代表水泵就会运转，水泵运转要达到浇水下限的值。<br><br>
4.写有传感器和水泵的保护代码，一旦传感器或水泵故障即可触发保护机制，让浇水系统停止工作，并显示故障原因。<br>
传感器保护机制就比较简单，若传感器没工作，读取传感器数值的引脚就会受到干扰，数值会变得非常大，只要判断数值超过一定值就触发保护机制。<br>
水泵保护则是使用水泵超时时间来设定，若输出接口打开，10秒后记录当前的土壤湿度值，过一段时间在将旧的土壤湿度值跟现在的对比,若变化小于5，即会触发保护使浇水系统停止，即可判断水泵没接或水泵没工作或水管没插到土里。<br><br>

## 主要功能介绍<br>
1.自定义浇水上限和下限<br>
2.自定义浇水系统休眠时间<br>
3.水泵和传感器异常保护机制<br>
4.强制关闭传感器<br>
5.手动开启关闭浇水功能<br>
6.自定义水泵超时保护时间<br>
7.水泵接口翻转<br>
8.读取电池电压校准<br>
9.电池充电时的动画<br>
10.水泵运转时间显示<br>
11.水泵运转时的动画<br>
12.自定义屏幕亮度<br>
13.数据断电保存 <br><br>
A.自定义浇水上下限：浇水的下限就是土壤干到什么程度才开始浇水，上限就是土壤要浇到多湿才停止。<br><br>
B.自定义休眠时间：没有浇水任务会自动休眠,休眠能大大节省电量。<br><br>
C.水泵超时保护：水泵超时时间内土壤湿度是否有变化，如设定60即是每隔60秒内土壤湿度变化需要超过5个值，否者会触发保护机制，以免没浇到水而无止境的运转水泵而使电量耗尽。<br><br>
D.水泵接口翻转：控制水泵正反转，注意要水泵支持正反转才可使用！<br><br>
E.电池电压校准：电池电压数值校准，因为每块电路板的基准电压都不会是5.00V，有时候会高低那么零点零几伏所以需要手动校准，使用万用表测量电池的电压进行对比校准。<br><br>
F.自定义屏幕亮度：主界面下长上下按键可以调节OELD的亮度。<br><br>
G.水泵运转时和充电时会有动画提示。<br><br>

## 引脚定义<br>
6-电机驱动输入引脚1<br>
5-电机驱动输入引脚2<br>
12-传感器电源正极<br>
13-led指示灯（暂时未启用）<br>
2-下按键<br>
3-上按键<br>
4-确认按键<br>
A3-读取电压的引脚<br>
A0-读取土壤湿度的引脚<br>
A2-读取充电状态的引脚<br>
A4-OLED,SDA<br>
A5-OLED,SCL<br>

程序更新说明

    092c
    1.将按键的消抖改为对比时间式的消抖，不再使用delay进行消抖，效果更佳
 
    091c
    1.将水泵超时的警告取消，改成水泵超时后进入休眠 
    2.优化休眠唤醒后误判断传感器错误
    3.设置界面湿度数值前面增加负号
    
    090c
    1.设置界面第二页增加4项的设置
    a.传感器开关
    b.水泵超时
    c.水泵接口翻转
    d.电压校准
    2.修正水泵运转时间显示
    3.主界面下长按按键可调节亮度
    4.优化一些代码逻辑

    080c
    1.因硬件问题移除水泵PWM输出,改为普通高低电平控制，pwm输出会导致系统卡死
    2.主界面增加电池充电时的动画
    3.主界面增加水泵运转时间显示
    4.主界面增加水泵运转时的动画
![v7.0](https://github.com/jie326513988/Arduino-Water-the-plants/blob/master/picture/v7.0.png)
![v6.0](https://github.com/jie326513988/Arduino-Water-the-plants/blob/master/picture/v6.0.png)
![](https://github.com/jie326513988/Arduino-Water-the-plants/blob/master/picture/js4056-3.jpg)
![](https://github.com/jie326513988/Arduino-Water-the-plants/blob/master/picture/js4056-4.jpg)
![](https://github.com/jie326513988/Arduino-Water-the-plants/blob/master/picture/js4056-5.jpg)
![](https://github.com/jie326513988/Arduino-Water-the-plants/blob/master/picture/js4056-6.jpg)
